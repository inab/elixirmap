var articlesPerJournalChart,articlesPerYearChart,articlesPerTopicChart;let selectedTipoValue="'%%'",selectedAuthorValue="'%%'",selectedYearsArray="2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018",selectedJournalsArray="Oxford Bioinformatics,BMC Bioinformatics,Nucleic Acids Research,BMC Genomics,PLoS Computational Biology",selectedTopicsArray="'Computational Biology > Molecular genetics', 'Software > Tools', 'Computational Biology > Nucleic acids > DNA', 'Computational Biology > Nucleic acids > RNA', 'Computational Biology > Phylogeny', 'Computational Biology > Sequence analysis', 'Computational Biology > Molecular interactions, pathways and networks', 'Computational Biology > Structure analysis', 'Omics > Genomics > Functional genomics', 'Omics > Genomics > Pharmacogenomics', 'Proteomics', 'Omics > Genomics > Transcriptomics', 'Computational Biology > Sequence analysis > Mapping'";var API_KEY="9d3d3e19781c35ce76c075e4cfe9d5caa1604ce9",USER_NAME="carto-bsc",SQL_CLIENT=axios.create({method:"get",url:"https://"+USER_NAME+".carto.com/api/v2/sql?",params:{api_key:API_KEY}});function updatePerJournalPlot(){}function updatePerYearPlot(){var d="SELECT year,COUNT(DISTINCT(title)) FROM articles_spa_elixir_v1 WHERE year IN ("+selectedYearsArray+") AND authors LIKE ("+selectedAuthorValue+") AND inb_grant LIKE ("+selectedTipoValue+") GROUP BY year ORDER by year ASC";SQL_CLIENT.request({params:{q:d}}).then(function(f){if(f&&f.data){dataArray=[],labelsArray=[];for(var g=0;g<f.data.rows.length;g++)dataArray.push(f.data.rows[g].count),labelsArray.push(f.data.rows[g].year);if(options={},data={datasets:[{data:dataArray,backgroundColor:"#feb236",hoverBackgroundColor:"#feb236"}],labels:labelsArray},$("#map").css("z-index",1),$("#histogram").css("z-index",2),$("#articlesPerYearChart").css("z-index",3),articlesPerYearChart){$("#articlesPerYearChart").remove(),$("#histogram").append("<canvas id=\"articlesPerYearChart\" width=\"30\" height=\"20%\"><canvas>");var h=$("#articlesPerYearChart");articlesPerYearChart=new Chart(h,{type:"bar",data:data,options:{maintainAspectRatio:!0,legend:{display:!1}},borderWidth:1})}else{var h=$("#articlesPerYearChart");articlesPerYearChart=new Chart(h,{type:"bar",data:data,options:{maintainAspectRatio:!0,legend:{display:!1}},borderWidth:1})}}}).catch(function(){}),hidePlots()}function updatePerTopicPlot(){}function componentToHex(d){var f=d.toString(16);return 1==f.length?"0"+f:f}function getJournalColor(d){switch(d.trim()){case"BMC Genomics":return"#006E51";case"Oxford Bioinformatics":return"#D8AE47";case"Nucleic Acids Research":return"#034F84";case"BMC Bioinformatics":return"#955251";case"PLoS Computational Biology":return"#009B77";default:return"#000000";}}function getTopicColor(d){switch(d.trim()){case"DNA":return"#FE2712";case"RNA":return"#FC600A";case"Phylogeny":return"#FB9902";case"Sequence analysis":return"#FCCC1A";case"Mapping":return"#FEFE33";case"Structure analysis":return"#B2D732";case"Functional genomics":return"#66B032";case"Pharmacogenomics":return"#8601AF";case"Proteomics":return"#C21460";case"Mol. int., pathways and networks":return"#6C4F3D";case"Molecular genetics":return"#672E3B";case"Transcriptomics":return"#9C9A40";case"Tools":return"#F6D155";default:return"#000000";}}function getColorsArray(d){return["#fbb735","#e98931","#eb403b","#b32E37","#6c2a6a","#5c4399","#274389","#1f5ea8","#227FB0","#2ab0c5","#39c0b3","#b3cae5","#dbdde4","#e4e3e4","#f7ddbb","#efcab2","#bccacc","#c7d8d6","#d9ebe0","#ebf9e3","#f4f8d0","#5e7fb1","#dce8f7","#eff1f4","#fce1a8","#f7ec86","#8fb8ee","#cbe2f4","#dbe5eb","#f9d3b8","#e0b2a3","#a2e0f9","#cef5fc","#eafaeb","#fefcd3","#fdf4ba","#6bafd2","#a4c8dc","#d6cbca","#eabc96","#db8876","#b4ced8","#d7e5d4","#e2e8c9","#f1e5b9","#edd7ac","#29153e","#657489","#bfb6aa","#ead79d","#f2ebda","#20202f","#273550","#416081","#adacb2","#eac3a2","#555351","#555351","#8d7b6c","#cc9d7a","#fff9aa","#171c33","#525f83","#848896","#bb9d78","#f6e183","#ffe3c8","#efad9e","#c79797","#a78a92","#857d8d","#6f749e","#9a8daf","#d0a8b9","#f8bbb1","#fde6b1","#536a97","#8087ad","#bca391","#bd968a","#a38b8a","#325176","#7b9ea7","#9baf93","#dbaf81","#fbdf73","#727288","#8e889b","#d3c2bd","#f9d89a","#f8c785","#506e90","#7695aa","#a7bdb8","#e2e2b8","#fdf998","#634b5f","#868080","#b7b29b","#dfd6a4","#e9f3a2","#7e74b2","#b3a2c2","#e2cdbe","#f6cf97","#f4a77a","#34a4ca","#59d7dd","#a8f2f0","#d0f8ef","#d6f6e1","#7696cd","#8fb2e4","#b0cff0","#d7e5ec","#dee0e7","#8dd6c3","#c5e5e2","#eafaeb","#f9f7ca","#fceea1","#4e72c7","#6d9ed7","#a4c8d5","#b4d9e1","#c4d9d6","#47565f","#5b625a","#947461","#f98056","#f7ec86","#95b3bf","#c6cdd3","#e5d8d9","#f1e1d9","#f3e1cd","#4c86ab","#95a5bc","#bfcdc9","#dcd6c9","#edd9c7","#0f124a","#1b2360","#515b80","#758391","#e5e3b0","#889db6","#a5b8ce","#c1cfdd","#dee1e4","#d5d1cf","#74bddb","#a8d1eb","#cddbf5","#e4e6fb","#f6f4f8","#a7d3cb","#bcc1c4","#e5cab3","#fee6c5","#fdecd0","#325571","#8e9fa4","#decab2","#f2d580","#ffa642","#c5d4d7","#d6b98d","#c99262","#8c5962","#43577e"].slice(0,d)}function hidePlots(){$("#articlesPerJournalChartTitle").hide(),$("#articlesPerJournalChart").hide(),$("#articlesPerYearChartTitle").hide(),$("#articlesPerYearChart").hide(),$("#articlesPerTopicChartTitle").hide(),$("#articlesPerTopicChart").hide(),$("#histogram").hide(),map.closePopup()}function main(){const g=$("#style").text(),h=_.template($("#query").html()),k=$("#slider-container"),m=$("#slider-cities");map=L.map("map",{zoomControl:!1,center:[38.41,-3.7],zoom:5,minZoom:5,maxZoom:24}),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}.png",{maxZoom:18,zIndex:0}).addTo(map),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}.png",{maxZoom:18,zIndex:0}).addTo(map),L.control.zoom({position:"bottomleft"}).addTo(map);const n=new carto.Client({apiKey:"9d3d3e19781c35ce76c075e4cfe9d5caa1604ce9",username:"carto-bsc"});let o=new carto.source.SQL(h({year:selectedYearsArray,typeVariable:selectedTipoValue,authorsVariable:selectedAuthorValue})),p=new carto.style.CartoCSS(g),q=new carto.layer.Layer(o,p,{featureClickColumns:["name","papers","type"]});n.addLayer(q),n.getLeafletLayer().addTo(map),$(document).ready(function(){$("#moreInfoButton").click(function(){$("#myModalMoreInfo").appendTo("body").modal("show")}),$("#listaArticulosInstitucion").click(function(){var v={};SQL_CLIENT.request({params:{q:"select distinct(nameaffiliation), count(distinct(title)) from articles_spa_elixir_v1 where year IN ("+selectedYearsArray+") group by nameaffiliation order by count(distinct(title)) desc"}}).then(function(w){for(var y=0;y<w.data.rows.length;y++)v[w.data.rows[y].nameaffiliation]={Sí:0,No:0};SQL_CLIENT.request({params:{q:"select nameaffiliation, inb_grant, count(distinct(title)) from articles_spa_elixir_v1 where year IN ("+selectedYearsArray+") group by nameaffiliation, inb_grant order by nameaffiliation ASC"}}).then(function(A){A&&A.data,console.log(A.data),console.log("hash"),console.log(v),$("#cuerpoTablaListaArticulosInstitucion").html("");for(var B=0;B<A.data.rows.length;B++)v[A.data.rows[B].nameaffiliation][A.data.rows[B].inb_grant]=A.data.rows[B].count;Object.keys(v).forEach(function(C){var D=v[C];$("#cuerpoTablaListaArticulosInstitucion").append("<tr><td>"+C+"</td><td>"+D.Sí+"</td><td>"+D.No+"</td><td>")}),$("#cuerpoTablaListaArticulosInstitucion").append("</tr>"),$("#myModalListado").appendTo("body").modal("show"),console.log("hash2"),console.log(v)}).catch(function(){}).catch(function(){})})});var u=[];SQL_CLIENT.request({params:{q:"SELECT DISTINCT(author) FROM spa_people_names ORDER by author ASC"}}).then(function(v){if(v&&v.data){dataArray=[],labelsArray=[];for(var w=0;w<v.data.rows.length;w++)u.push({label:v.data.rows[w].author,value:v.data.rows[w].author}),console.log(v.data.rows[w].author);$("#buscarInvestigadorInput").autocomplete({minLength:2,source:function(y,A){var B=$.ui.autocomplete.filter(u,y.term);A(B.slice(0,15))},updater:function(y){return y},select:function(y,A){y.preventDefault(),$("#buscarInvestigadorInput").val(A.item.value),console.log("Investigador seleccionado: "+A.item.value),selectedAuthorValue="'%"+A.item.value+"%'",o.setQuery(h({year:selectedYearsArray,typeVariable:selectedTipoValue,authorsVariable:selectedAuthorValue})),q=new carto.layer.Layer(o,p,{featureClickColumns:["name","papers","type"]}),updatePerYearPlot(),hidePlots()},focus:function(y,A){y.preventDefault(),$("#buscarInvestigadorInput").val(A.item.value)}}),$("#investigadorClearButton").click(function(){1<$("#buscarInvestigadorInput").val().length?($("#buscarInvestigadorInput").val(""),selectedAuthorValue="'%%'",o.setQuery(h({year:selectedYearsArray,typeVariable:selectedTipoValue,authorsVariable:selectedAuthorValue})),q=new carto.layer.Layer(o,p,{featureClickColumns:["name","papers","type"]}),updatePerYearPlot(),hidePlots()):($("#alertBox").fadeIn(),setTimeout(function(){$("#alertBox").fadeOut()},5e3))}),$("#investigadorVerButton").click(function(){1<$("#buscarInvestigadorInput").val().length?SQL_CLIENT.request({params:{q:"SELECT title,year,source,citations,doi,authors FROM articles_spa_elixir_v1 WHERE authors LIKE ("+selectedAuthorValue+") AND year IN ("+selectedYearsArray+") ORDER by year ASC"}}).then(function(y){y&&y.data,console.log(y.data),$("#cuerpoTablaArticulosInvestigador").html("");for(var A=0;A<y.data.rows.length;A++)console.log(A),$("#cuerpoTablaArticulosInvestigador").append("<tr><td>"+y.data.rows[A].title+"</td><td>"+y.data.rows[A].year+"</td><td>"+y.data.rows[A].source+"</td><td>"+y.data.rows[A].citations+"</td><td>"+y.data.rows[A].authors+"</td><td><a href=\"http://dx.doi.org/"+y.data.rows[A].doi+"\" target=\"_blank\">"+y.data.rows[A].doi+"</a></td><td>");$("#cuerpoTablaArticulosInvestigador").append("</tr>"),$("#myModalInvestigador").appendTo("body").modal("show")}).catch(function(){}):($("#alertBox").fadeIn(),setTimeout(function(){$("#alertBox").fadeOut()},5e3))})}}).catch(function(){}),$("[data-toggle=\"tooltip\"]").tooltip(),$("[data-toggle=tooltip]").tooltip({placement:$(this).data("placement")||"top"}),selectedYearsArray="1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018",selectedJournalsArray="Oxford Bioinformatics,BMC Bioinformatics,Nucleic Acids Research,BMC Genomics,PLoS Computational Biology",selectedTopicsArray="'Computational Biology > Molecular genetics', 'Software > Tools', 'Computational Biology > Nucleic acids > DNA', 'Computational Biology > Nucleic acids > RNA', 'Computational Biology > Phylogeny', 'Computational Biology > Sequence analysis', 'Computational Biology > Molecular interactions, pathways and networks', 'Computational Biology > Structure analysis', 'Omics > Genomics > Functional genomics', 'Omics > Genomics > Pharmacogenomics', 'Proteomics', 'Omics > Genomics > Transcriptomics', 'Computational Biology > Sequence analysis > Mapping'",function(v){function w(F){F=F||window.event,D=F.clientX,E=F.clientY,document.onmouseup=A,document.onmousemove=y}function y(F){F=F||window.event,B=D-F.clientX,C=E-F.clientY,D=F.clientX,E=F.clientY,v.style.top=v.offsetTop-C+"px",v.style.left=v.offsetLeft-B+"px"}function A(){document.onmouseup=null,document.onmousemove=null}var B=0,C=0,D=0,E=0;document.getElementById(v.id+"header")?document.getElementById(v.id+"header").onmousedown=w:v.onmousedown=w}(document.getElementById("histogram")),$("#leftSidebar").hide(),$("#histogram").hide(),$("#articlesPerJournalChartTitle").hide(),$("#articlesPerJournalChart").hide(),$("#articlesPerYearChartTitle").hide(),$("#articlesPerYearChart").hide(),$("#articlesPerTopicChartTitle").hide(),$("#articlesPerTopicChart").hide(),$("#histogramClose").click(function(){hidePlots()}),$("#sidebarButtonOpen").click(function(){$("#sidebarButtonClosed").show(),$("#leftSidebar").fadeOut()}),$("#sidebarButtonClosed").click(function(){$("#sidebarButtonClosed").hide(),$("#leftSidebar").fadeIn()}),$("#plotArticlesPerJournal").click(function(){hidePlots(),$("#histogram").fadeIn(),$("#articlesPerJournalChartTitle").fadeIn(),$("#articlesPerJournalChart").fadeIn()}),$("#plotArticlesPerYear").click(function(){hidePlots(),$("#histogram").fadeIn(),$("#articlesPerYearChartTitle").fadeIn(),$("#articlesPerYearChart").fadeIn()}),$("#plotArticlesPerTopic").click(function(){hidePlots(),$("#histogram").fadeIn(),$("#articlesPerTopicChartTitle").fadeIn(),$("#articlesPerTopicChart").fadeIn()}),SQL_CLIENT.request({params:{q:"SELECT year,SUM(CAST(num_papers AS INT)) FROM results_elixir_v1 GROUP BY year ORDER by year ASC"}}).then(function(v){if(v&&v.data){dataArray=[],labelsArray=[];for(var w=0;w<v.data.rows.length;w++)dataArray.push(v.data.rows[w].sum),labelsArray.push(v.data.rows[w].year);options={},data={datasets:[{data:dataArray,backgroundColor:getColorsArray(0),hoverBackgroundColor:getColorsArray(0)}],labels:labelsArray},$("#map").css("z-index",1),$("#histogram").css("z-index",2),$("#articlesPerYearChart").css("z-index",3);var y=$("#articlesPerYearChart"),A=new Chart(y,{type:"bar",data:data,options:{maintainAspectRatio:!1,legend:{display:!1}},borderWidth:1})}}).catch(function(){}),$("#yearSelector").multiselect({includeSelectAllOption:!0,allSelectedText:"Todos los a\xF1os",buttonWidth:"200px",onChange:function(){},buttonText:function(v){if(0<v.length){var w=[];v.each(function(){w.push([$(this).text(),$(this).data("order")])}),w.sort(function(B,C){return B[1]-C[1]});for(var y="",A=0;A<w.length;A++)y+=w[A][0]+", ";selectedYearsArray=y.substr(0,y.length-2),console.log("holaaa"),console.log(selectedAuthorValue),o.setQuery(h({year:selectedYearsArray,typeVariable:selectedTipoValue,authorsVariable:selectedAuthorValue})),q=new carto.layer.Layer(o,p,{featureClickColumns:["name","papers","type"]}),console.log(selectedYearsArray),console.log(selectedTipoValue),console.log(selectedAuthorValue),updatePerYearPlot(),hidePlots()}return 0===v.length?(o.setQuery(h({year:["9999"],typeVariable:selectedTipoValue,authorsVariable:selectedAuthorValue})),q=new carto.layer.Layer(o,p,{featureClickColumns:["name","papers","type"]}),selectedYearsArray=["9999"],"0 a\xF1os seleccionados"):v.length+" a\xF1os seleccionados"}},"selectAll"),$("option",$("#yearSelector")).each(function(){$(this).removeAttr("selected").prop("selected",!0)}),$("#yearSelector").multiselect("refresh"),$("#tipoSelector").multiselect({includeSelectAllOption:!0,selectAllText:"Seleccionar todas",buttonWidth:"200px",allSelectedText:"Todas",onChange:function(){},buttonText:function(v){if(0<v.length){var w=[];v.each(function(){w.push([$(this).val(),$(this).data("order")])}),w.sort(function(C,D){return C[1]-D[1]});for(var y="",A=0;A<w.length;A++)y+="'"+w[A][0]+"', ";var B=y.substr(0,y.length-2).split("'")[1];"Otras"==B&&(selectedTipoValue="'%No%'"),"Elixir"==B&&(selectedTipoValue="'%S\xED%'"),"Todas"==B&&(selectedTipoValue="'%%'"),o.setQuery(h({year:selectedYearsArray,typeVariable:selectedTipoValue,authorsVariable:selectedAuthorValue})),q=new carto.layer.Layer(o,p,{featureClickColumns:["name","papers","type"]}),updatePerYearPlot(),hidePlots()}return 0===v.length?"0 cat. seleccionadas":(updatePerYearPlot(),hidePlots(),"Otras"==v[0].outerText&&(selectedTipoValue="'%No%'"),"Elixir"==v[0].outerText&&(selectedTipoValue="'%S\xED%'"),"Todas"==v[0].outerText&&(selectedTipoValue="'%%'"),v[0].outerText)}},"selectAll"),$("option",$("#tipoSelector")).each(function(){$(this).removeAttr("selected").prop("selected",!0)}),$("#tipoSelector").multiselect("refresh")});const r=L.popup({closeButton:!0});q.on("featureClicked",function(s){if(r.setLatLng(s.latLng),!r.isOpen()){let v="";if(v+=`<div class="popup-container" id="institutionWindow">`,s.data.name){var u="SELECT COUNT(DISTINCT(title)) FROM articles_spa_elixir_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+")";"Hospital"==s.data.type&&(u="SELECT COUNT(DISTINCT(title)) FROM articles_spa_hospitales_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+")"),SQL_CLIENT.request({params:{q:u}}).then(function(w){if(w&&w.data){var y=w.data.rows[0].count;v+=`<h4>INSTITUCIÓN: ${s.data.name}</h4>`,v+=`<br>`,v+=`<p><b>ARTÍCULOS EN ESTE PERIODO:</b> ${y}</p>`,v+=`<center><button type="button" id ="mostrarArticulosInstitucion" data-toggle="tooltip" data-placement="right" title="Ver artículos" class="btn btn-primary" style="z-index: 10; width: 70%;">Ver artículos</button></center><br>`,v+=`<canvas id="bar-chart" width="400" height="250"></canvas><br>`,v+=`<canvas id="elixirPercentageChart" width="400" height="250"></canvas><br>`,v+=`</div>`,v+=`<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Artículos de esta institución</h4>
      </div>
      <div class="modal-body">
        <table class="table">
    <thead>
      <tr>
        <th>Título</th>
        <th>Año</th>
		<th>Citas</th>
		<th>Autores</th>
		<th>DOI</th>
		<th>Financiación INB/ELIXIR-ES</th>
      </tr>
    </thead>
    <tbody id="cuerpoTablaArticulos">
      <tr>
        
      
    </tbody>
  </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div>

  </div>
</div>`,r.setContent(v),r.openOn(map);var A="SELECT DISTINCT(title),year,citations,doi,authors,inb_grant FROM articles_spa_elixir_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+") ORDER by year ASC";"Hospital"==s.data.type&&(A="SELECT DISTINCT(title),year,citations,doi,authors,inb_grant FROM articles_spa_hospitales_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+") ORDER by year ASC"),$("#mostrarArticulosInstitucion").click(function(){SQL_CLIENT.request({params:{q:A}}).then(function(H){H&&H.data,console.log(H.data),$("#cuerpoTablaArticulos").html("");for(var I=0;I<H.data.rows.length;I++)console.log(I),$("#cuerpoTablaArticulos").append("<tr><td>"+H.data.rows[I].title+"</td><td>"+H.data.rows[I].year+"</td><td>"+H.data.rows[I].citations+"</td><td>"+H.data.rows[I].authors+"</td><td><a href=\"http://dx.doi.org/"+H.data.rows[I].doi+"\" target=\"_blank\">"+H.data.rows[I].doi+"</a></td><td>"+H.data.rows[I].inb_grant+"</td><td>");$("#cuerpoTablaArticulos").append("</tr>"),$("#myModal").appendTo("body").modal("show")}).catch(function(){})});var B=function(H){return H.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},E=[],F=[s.data.year],G="SELECT year,COUNT(DISTINCT(title)) FROM articles_spa_elixir_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+") GROUP BY year ORDER by year ASC";"Hospital"==s.data.type&&(G="SELECT year,COUNT(DISTINCT(title)) FROM articles_spa_hospitales_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+") GROUP BY year ORDER by year ASC"),SQL_CLIENT.request({params:{q:G}}).then(function(H){if(H&&H.data){console.log(H.data),dataArray=[],labelsArray=[];for(var J=selectedYearsArray.split(","),K=0;K<selectedYearsArray.split(",").length;K++)labelsArray.includes(parseInt(selectedYearsArray.split(",")[K].trim(),10))||labelsArray.push(parseInt(selectedYearsArray.split(",")[K].trim(),10));labelsArray.sort(function(W,X){return W-X});labelsArray.length;datapackColors=getColorsArray(1);for(var N=[],O=[],Q=0;Q<selectedYearsArray.split(",").length;Q++)N.push({year:parseInt(selectedYearsArray.split(",")[Q].trim(),10),value:0});console.log("c");for(var R=0;R<N.length;R++)for(var S=0;S<H.data.rows.length;S++)parseInt(H.data.rows[S].year,10)==N[R].year&&(N[R].value=H.data.rows[S].count),O.includes(parseInt(H.data.rows[S].year,10))||O.push(parseInt(H.data.rows[S].year,10));finalDataArray=[];for(var R=0;R<N.length;R++)finalDataArray.push(N[R].value);var T={label:["N\xFAmero de art\xEDculos"],data:finalDataArray,backgroundColor:"#f9c91d",hoverBackgroundColor:"#f9c91d",hoverBorderWidth:2,hoverBorderColor:"lightgrey"};E.push(T),console.log(E);var U=document.getElementById("bar-chart"),V=new Chart(U,{type:"bar",data:{labels:labelsArray,datasets:E},options:{title:{display:!0,text:"Art\xEDculos por a\xF1o"},animation:{duration:10},tooltips:{mode:"label",position:"nearest",intersection:!1,callbacks:{label:function(W,X){return X.datasets[W.datasetIndex].label+": "+B(W.yLabel)}}},scales:{xAxes:[{stacked:!0,gridLines:{display:!1}}],yAxes:[{stacked:!0,ticks:{beginAtZero:!0,callback:function(W){if(0==W%1)return W}}}]},legend:{display:!1}}});G="Hospital"==s.data.type?"SELECT COUNT(DISTINCT(title)),inb_grant FROM articles_spa_hospitales_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+") GROUP BY inb_grant ORDER BY inb_grant":"SELECT COUNT(DISTINCT(title)),inb_grant FROM articles_spa_elixir_v1 WHERE nameaffiliation = '"+s.data.name+"' AND year IN ("+selectedYearsArray+") AND inb_grant LIKE ("+selectedTipoValue+") GROUP BY inb_grant ORDER BY inb_grant",SQL_CLIENT.request({params:{q:G}}).then(function(W){if(W&&W.data){E=[],labelsArray=[];for(var Y=0;Y<W.data.rows.length;Y++)"No"==W.data.rows[Y].inb_grant?(labelsArray.push("Otro tipo de financiaci\xF3n"),E.push(W.data.rows[Y].count)):"S\xED"==W.data.rows[Y].inb_grant&&(labelsArray.push("INB/ELIXIR-ES"),E.push(W.data.rows[Y].count));datapackColors=getColorsArray(2),data={datasets:[{data:E,backgroundColor:datapackColors}],labels:labelsArray};var Z=document.getElementById("elixirPercentageChart"),aa=new Chart(Z,{type:"pie",data:data,options:{title:{display:!0,text:"Cantidad de art\xEDculos seg\xFAn finaciaci\xF3n"},legend:{display:!1}},borderWidth:1})}}).catch(function(){})}}).catch(function(){})}}).catch(function(){})}}})}window.onload=main;